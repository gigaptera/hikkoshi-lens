# 機能一覧 (Function List)

## 1. ステーション検索・フィルタリング機能

バックエンド API: `GET /api/stations/nearby` (or `search`)

### 1-1. 基本検索

- **位置情報検索**: 緯度経度 (`lat`, `lon`) を指定して、指定半径内 (`radius`、初期値 500m) の駅を検索。
- **家賃相場フィルタ**:
  - 下限 (`min_rent`) 〜 上限 (`max_rent`) の指定が可能。
  - 建物種別 (`building_type`) と 間取り (`layout`) を指定することで、より正確な相場データとの照合を行う。
    - 建物種別: マンション (`mansion`)、アパート (`apart`)、一戸建て (`detached`)
    - 間取り: ワンルーム/1K/1DK (`1r_1k_1dk`)、1LDK/2K/2DK (`1ldk_2k_2dk`)、等

### 1-2. 家賃補助・通勤検索 (Subsidy Search)

- **勤務先等の最寄り駅基準検索**:
  - `subsidy_type=from_workplace` を指定。
  - 最寄り駅から同一路線上の前後 N 駅 (`subsidy_range`、デフォルト 3 駅) を含めて検索結果として返す。
  - 検索結果には「最寄り駅からの駅数 (`stops_from_source`)」が含まれる。

### 1-3. 路線別駅取得 (Line Search)

- **特定路線の駅一覧取得**:
  - エンドポイント: `GET /api/stations/line`
  - パラメータ: `organization_code` (鉄道事業者コード), `line_name` (路線名)
  - 用途: 最寄り駅が属する路線の全駅を取得し、比較検討の幅を広げるために使用。

## 2. スコアリング・評価機能 (Scoring)

バックエンド API: 内部ロジック (`ScoringService`) **※現在未実装（プレースホルダー値または簡易ロジックを返却中）**

### 2-1. 5 軸スコア算出

ユーザーが指定した重み (`weights`) に基づき、各駅の総合スコアと項目別スコアを算出。

- **Access (アクセス)**: 都心や主要駅への利便性 (現状ロジック要確認、重み対応)
- **Rent (家賃)**: 家賃相場の安さ (重み対応)
- **Facility (周辺施設)**: スーパー、コンビニ等の充実度 (重み対応)
- **Safety (治安)**: 治安の良さ (重み対応)
- **Disaster (防災)**: 自然災害リスクの低さ (重み対応)

## 3. 詳細・比較機能

バックエンド API: `GET /api/stations/{id}/three-stops`

### 3-1. 駅詳細分析 (Station Analysis)

- **インタラクティブマップ**:
  - 駅周辺の施設（スーパー、コンビニ、病院、公園など）を地図上に表示。
  - レイヤー切り替えにより、ハザードマップ（洪水・土砂災害リスク）や治安ヒートマップを表示。
- **データ可視化**:
  - 5 軸スコア（家賃、治安、利便性、アクセス、防災）のレーダーチャート。
  - 間取り別の家賃相場グラフ。
- **アクセス分析**:
  - 主要ターミナル駅への所要時間と乗り換え回数。

### 3-2. 駅詳細情報 API

- **基本情報**: 駅名、路線名、所在地。
- **ジオデータ**: 周辺施設の GeoJSON、ハザードエリア情報。
- **市場価格情報**: 間取り別家賃相場データ。

## 4. 地点詳細・周辺分析機能 (Location Detail)

バックエンド API: `GET /api/location/detail` **※新規実装予定**

### 4-1. 住所ベース周辺情報取得

- **用途**: SUUMO 等で見つけた物件の住所から、その地点の周辺情報を詳細に分析。
- **入力**:
  - `address`: 住所文字列（例: "東京都世田谷区三軒茶屋 1-2-3"）
  - または `lat`, `lng`: 緯度経度
- **処理**:
  1. 住所 → Geocoding API で緯度経度に変換
  2. 最寄り駅の特定（既存 `/api/stations/nearby` を活用）
  3. 周辺施設の検索（コンビニ、スーパー、病院、公園等）
  4. 治安データの取得
  5. 家賃相場の取得（既存 `market_prices` テーブルを活用）

### 4-2. 地点スコアリング

各地点について以下のスコアを算出:

- **Access (駅アクセス)**: 最寄り駅までの徒歩時間に基づく評価
- **Facility (周辺施設)**: コンビニ、スーパー、病院、公園の充実度
- **Safety (治安)**: 犯罪率データに基づく評価
- **Cost (物価)**: 周辺家賃相場の安さ
- **Total Score (総合スコア)**: 上記を統合した総合評価

### 4-3. 複数地点比較（将来機能）

- 検討リストに複数の地点を保存
- スコアを横並びで比較
- 最終的な物件決定を支援
